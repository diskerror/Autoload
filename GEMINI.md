# Diskerror Autoload

## Project Overview

`diskerror/autoload` is a custom PHP autoloader designed to replace the standard Composer autoloader. It leverages the PHP `ext-ds` (Data Structures) extension to use efficient `Ds\Map` structures instead of standard PHP arrays for managing class maps and namespaces. This is intended to offer performance benefits, particularly in applications with a large number of classes.

**Key Features:**
*   **`ext-ds` Integration:** Uses `Ds\Map` for faster lookups.
*   **Caching:** Caches the processed autoload maps to `vendor/autoload.cache` to reduce initialization overhead.
*   **Fallback Mechanism:** Automatically falls back to the standard Composer autoloader if `ext-ds` is missing or the PHP version is too old (< 7.4).
*   **Composer Compatible:** Reads and uses the standard autoload files generated by Composer (`autoload_classmap.php`, `autoload_psr4.php`, etc.).

## Requirements

*   **PHP:** >= 7.4
*   **Extension:** `ext-ds` ^1.5

## Usage

To use this autoloader in your project, replace the standard Composer autoloader inclusion:

```php
// Standard Composer Autoload
// require 'vendor/autoload.php';

// Diskerror Autoload
require 'vendor/diskerror/autoload/autoload.php';
```

## Architecture

1.  **Entry Point (`autoload.php`):**
    *   Checks if the `ds` extension is loaded and if PHP >= 7.4.
    *   If conditions are not met, it simply requires the standard `vendor/autoload.php` and returns.
    *   If conditions are met, it loads `Autoloader.php` and initializes the custom autoloader.

2.  **Logic (`Autoloader.php`):**
    *   **Initialization (`init`):**
        *   Locates Composer's generated autoload files in `vendor/composer/`.
        *   Checks for an existing `vendor/autoload.cache`.
        *   If the cache is missing or older than the Composer files, it regenerates the maps (converting arrays to `Ds\Map`) and saves the cache.
    *   **Loading (`load`):**
        *   Registered via `spl_autoload_register`.
        *   Checks the class map first.
        *   Iterates through PSR-4 and legacy namespace maps to locate the file.
    *   **File Loading (`loadFiles`):**
        *   Includes files defined in `autoload_files.php` (e.g., helper function files).

## Key Files

*   **`autoload.php`:** The bootstrap file. Handles environment checks and registration.
*   **`Autoloader.php`:** The core class containing the logic for map generation, caching, and class loading.
*   **`composer.json`:** Defines dependencies and project metadata.
